<div class="utility-view rounded">
  <div class="container-fluid bg-primary rounded-top">
    <h4>Participant Release To {{ model.application.title }}</h4>
  </div>
  <div class="container-fluid">
    <div class="spacer">
      <p class="text-info" style="margin-top: 1em;">
        In order to release participants at once you must first select which participants to release.
        This can be done typing the unique identifiers (eg: A123456) of all participants you wish to have
        included in the operation, then confirm that list to ensure each of the identifiers can be linked
        to a participant.
      </p>
      <p class="text-info">
        Once you have confirmed the list of participant identifiers you will be presented with a summary
        of how many participants will be released to each site, broken down by cohort.
      </p>
      <p class="text-warning">
        Note: only participants with the correct cohort and who have not already been released will be allowed.
      </p>
      <hr />
      <div class="panel panel-default">
        <div class="panel-heading">
          <strong>Participant selection</strong>
          <span class="pull-right">
            <span ng-if="model.confirmInProgress">working, please wait...</span>
            <span ng-if="!model.confirmInProgress">
              {{ model.confirmedCount ?
                 model.confirmedCount + ' participants confirmed' :
                 'no confirmed participants' }}
              <i class="glyphicon" ng-class="model.confirmedCount ? 'glyphicon-ok' : 'glyphicon-remove'"></i>
            </span>
          </span>
        </div>
        <textarea id="uidListString"
                  name="uidListString"
                  cn-elastic
                  ng-change="model.uidListStringChanged()"
                  ng-model="model.uidListString"
                  ng-disabled="model.confirmInProgress"
                  class="form-control no-rounding"></textarea>
        <div class="form-footer text-right rounded-bottom bg-info">
          <button type="button"
                  class="btn btn-primary"
                  ng-disabled="null == model.application ||
                               null != model.confirmedCount ||
                               model.confirmInProgress"
                  ng-click="model.confirm()">Confirm List</button>
        </div> 
      </div>
      <div ng-if="model.confirmedCount">
        <div class="panel panel-default">
          <div class="panel-heading">
            <strong>Confirm selection</strong>
          </div>
          <div class="container-fluid panel-body">
            <div class="form-horizontal">
              <div ng-repeat="(cohort,siteList) in model.cohortSiteList">
                <h4 class="text-center">{{ cohort }}</h4>
                <div class="row" ng-repeat="(site,total) in siteList">
                  <label class="col-sm-6 control-label">{{ site }}</label>
                  <div class="col-sm-6 form-text">{{ total }}</div>
                </div>
                <hr ng-if="!$last" />
              </div>
            </div>
          </div>
          <div class="form-footer text-right rounded-bottom bg-info">
            <button type="button"
                    class="btn btn-primary"
                    ng-click="model.release()">Release Participants</button>
          </div> 
        </div>
      </div>
    </div>
  </div>
</div>
